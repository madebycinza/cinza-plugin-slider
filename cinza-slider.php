<?php

/**
 * Plugin Name:       Cinza Slider
 * Plugin URI:        https://cinza.io/plugin/slider/
 * Description:       A minimal slider plugin.
 * Version:           0.0.1
 * Requires at least: 5.2
 * Requires PHP:      7.2
 * Author:            Cinza Web Design
 * Author URI:        https://cinza.io/
 * License:           GPL v3 or later
 * License URI:       https://www.gnu.org/licenses/gpl-3.0.html
 */

defined( 'ABSPATH' ) || exit;

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Include all files
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

define( 'CSLIDER_PATH', plugin_dir_path( __FILE__ ) );
include_once( CSLIDER_PATH . 'includes/backend-cpts.php' );
include_once( CSLIDER_PATH . 'includes/backend-shortcodes.php' );
include_once( CSLIDER_PATH . 'includes/backend-react.php' );

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Activation hook
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

register_activation_hook( __FILE__, 'cslider_activate' );
function cslider_activate() { 
	
    // Register CPT
    cslider_register_post_type(); 
    
    // Reset permalinks
    flush_rewrite_rules(); 
}
    
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Deactivation hook
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

register_deactivation_hook( __FILE__, 'cslider_deactivate' );
function cslider_deactivate() {
    
    // Unregister CPT
    unregister_post_type( 'cinza_slider' );
    
    // Reset permalinks
    flush_rewrite_rules();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Register settings for all tabs
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
add_action( 'admin_init', 'cslider_settings_init' );
function cslider_settings_init() {
    register_setting( 'cslider_group', 'cslider', 'cslider_validate' );
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Enqueue scripts
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//add_action('admin_enqueue_scripts', 'cslider_scripts_init');
function cslider_scripts_init( $hook ) {
	
	// Enqueue scripts only when on the plugin page
	if ( 'toplevel_page_cinza-core' !== $hook ) return ;
		
	// Admin stylesheet
	wp_enqueue_style( 'cslider-backend-css', plugins_url('/assets/css/backend.css', __FILE__), array(), '1.0.0', false );
	
	// WP media modal
	wp_enqueue_media();
}